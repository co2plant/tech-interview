# 저장 프로시저(Stored Procedure, SP)란?

데이터베이스 시스템 내부에 저장되어 실행되는 **절차적 코드(Procedual code)**로 쿼리의 집합입니다.

개발자는 자신만의 함수, 프로시져를 작성해 DB에 저장하고, SQL문에서 호출할 수 있습니다.

# 왜 사용하는가?

## 장점

### 모듈화 및 재사용성
동일한 로직을 여러 애플리케이션에서 반복적으로 작성할 필요 없이, 프로시저 호출만으로 재사용할 수 있습니다. 로직 변경 시 프로시저만 수정하면 되므로 유지보수가 매우 용이합니다.

### 성능 향상
긴 SQL문을 매번 서버로 전송하는 대신, 짧은 호출문(CALL) 하나만 보내므로 네트워크 트래픽이 감소합니다. 또한 데이터베이스는 프로시저를 미리 최적화하여 실행 계획을 캐시해두므로 실행 속도가 빠릅니다.

### 보안 강화
사용자에게 테이블에 대한 직접적인 접근 권한을 주는 대신, **프로시저에 대한 실행(EXECUTE) 권한** 만 부여할 수 있습니다. 이를 통해 의도된 작업만 수행하도록 제한하여 데이터 보안을 높일 수 있습니다.

### 복잡한 로직 처리
SQL만으로 구현하기 어려운 조건문(IF), 반복문(WHILE, FOR) 등의 프로그래밍 요소를 사용하여 복잡한 비즈니스 로직을 데이터베이스 계층에서 직접 처리할 수 있습니다.

## 특징
### 함수(Functions)와의 관계 SQL은 함수와 프로시져를 모두 지원합니다. 동일한 이름의 프로시져나 함수가 여러 개 존재할 수 있지만, 인수의 개수나 유형이 달라야 합니다.

### 트리거(Triggers)와의 관계 트리거는 DBMS에 의해 데이터베이스 변경에 대한 응답으로 자동으로 호출되는 프로시져입니다. 트리거는 다음 세 가지 부분으로 구성됩니다:
• **이벤트(Event)**

트리거를 활성화하는 데이터베이스 변경 (예: 삽입, 삭제, 업데이트).

• **조건(Condition)**

트리거가 활성화될 때 실행되는 쿼리 또는 테스트.

• **동작(Action)**

트리거가 활성화되고 조건이 참일 때 실행되는 프로시져.

 특정 이벤트 발생 시, 예를 들어 INSERT, DELETE, UPDATE 문에 의해 활성화될 수 있으며, 사용자는 트리거가 실행되는지조차 모를 수 있습니다. 트리거는 변경된 튜플의 이전 값(old)과 새 값(new)을 참조할 수 있으며, 심지어 변경된 레코드들의 집합을 참조할 수도 있습니다. 하지만, 많은 트리거 애플리케이션은 저장 프로시져의 적절한 사용으로 대체될 수 있으며, 가능한 경우 트리거를 피하는 것이 좋습니다.

## 단점
### 버전 관리 와 배포의 복잡성
### 테스트 및 디버깅의 어려움
### 개발 생산성 및 협업 문제
### 유연성 및 확장성 저하

# 어떻게 사용하는가?
### 생성
```sql
DELIMITER $$
CREATE PROCEDURE temporal_stored_procedure( In or Out pramenter )
BEGIN

	SQL문 작성

END $$
DELIMITER;
```

### 호출
CALL 문을 사용하여 저장된 프로시저를 실행합니다.
```sql
CALL temporal_stored_procedure(parameter);
```

### 수정
ALTER PROCEDURE 문으로 기존 프로시저의 내용을 변경합니다.
```sql
ALTER temporal_stored_procedure();
```

### 삭제
DROP PROCEDURE 문으로 프로시저를 삭제합니다.
```sql
DROP temporal_stored_procedure();
```

## 주요 기능

### 매개변수 (Parameters)
IN(입력), OUT(출력) 매개변수를 사용하여 프로시저와 외부 간에 데이터를 주고받을 수 있습니다.

### 제어 흐름
조건문(IF), 반복문(WHILE, REPEAT), 예외 처리(Handler) 등 프로그래밍다운 로직 제어가 가능합니다.

### 외부 언어 연동
Java, C++, Python 등 외부 프로그래밍 언어로 작성된 함수를 데이터베이스 내에서 실행할 수 있어 활용도를 높일 수 있습니다.

# 언제 사용해야 하는가?
### 반복적인 로직 캡슐화
회원 가입, 주문 처리 등 여러 곳에서 공통적으로 사용되는 복잡한 트랜잭션을 하나의 프로시저로 만들어 사용합니다.

### 애플리케이션과 비즈니스 로직 분리
애플리케이션 코드의 부담을 줄이고, 데이터와 관련된 핵심 로직을 데이터베이스 계층에 집중시켜 관리하고자 할 때 유용합니다.

### 트리거(Trigger)
특정 테이블에 데이터 변경(INSERT, UPDATE, DELETE)이 발생했을 때 자동으로 실행될 동작을 정의하는 데 사용됩니다.


# 무엇을 주의해야 하는가?
스토어드 프로시저는 매우 강력하지만, 데이터베이스 종류(MySQL, Oracle, SQL Server 등)에 따라 문법이 달라 호환성이 떨어집니다. 따라서 다른 데이터베이스로 마이그레이션할 때 수정이 필요할 수 있다는 단점이 있습니다.


# 어떻게 관리하는가?

# 결론 및 Q&A

# 참고자료

[이것이 MySQL이다(8.0)](https://www.youtube.com/watch?v=cw1wGN0ZdFA)

[혼자 공부하는 SQL](https://www.youtube.com/watch?v=X0jwxUd37OI)

[hanker tistory](https://hanke-r.tistory.com/entry/SQL-%EC%A0%80%EC%9E%A5-%ED%94%84%EB%A1%9C%EC%8B%9C%EC%A0%80Stored-Procedure-SP%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80-%ED%94%84%EB%A1%9C%EC%8B%9C%EC%A0%80%EC%9D%98-%ED%99%9C%EC%9A%A9-%EB%B0%A9%EB%B2%95)

[햄버거의 개발](https://eunsun-zizone-zzang.tistory.com/52)